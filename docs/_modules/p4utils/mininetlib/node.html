

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>p4utils.mininetlib.node &mdash; P4-Utils 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'1.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  false,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> P4-Utils
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">General Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced_usage.html">Advanced Usage</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../p4utils.html">P4-Utils API reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">P4-Utils</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>p4utils.mininetlib.node</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for p4utils.mininetlib.node</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2013-present Barefoot Networks, Inc.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">mininet.log</span> <span class="kn">import</span> <span class="n">debug</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">warning</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">mininet.node</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Host</span><span class="p">,</span> <span class="n">Switch</span>
<span class="kn">from</span> <span class="nn">mininet.moduledeps</span> <span class="kn">import</span> <span class="n">pathCheck</span>

<span class="kn">from</span> <span class="nn">p4utils.utils.helper</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">SWITCH_START_TIMEOUT</span> <span class="o">=</span> <span class="mi">10</span>


<div class="viewcode-block" id="P4Host"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Host">[docs]</a><span class="k">class</span> <span class="nc">P4Host</span><span class="p">(</span><span class="n">Host</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Virtual hosts with custom configuration to work with P4 switches.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="P4Host.config"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Host.config">[docs]</a>    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configure host.&quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">off</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="s1">&#39;tx&#39;</span><span class="p">,</span> <span class="s1">&#39;sg&#39;</span><span class="p">]:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;/sbin/ethtool --offload </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> off&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaultIntf</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">off</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># disable IPv6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;sysctl -w net.ipv6.conf.all.disable_ipv6=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;sysctl -w net.ipv6.conf.default.disable_ipv6=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;sysctl -w net.ipv6.conf.lo.disable_ipv6=1&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="P4Host.describe"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Host.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sw_addr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sw_mac</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe host.&quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**********&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Network configuration for: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Default interface: </span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultIntf</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultIntf</span><span class="p">()</span><span class="o">.</span><span class="n">IP</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultIntf</span><span class="p">()</span><span class="o">.</span><span class="n">MAC</span><span class="p">()</span>
        <span class="p">))</span>
        <span class="k">if</span> <span class="n">sw_addr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">sw_mac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Default route to switch: </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sw_addr</span><span class="p">,</span> <span class="n">sw_mac</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**********&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="P4Switch"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch">[docs]</a><span class="k">class</span> <span class="nc">P4Switch</span><span class="p">(</span><span class="n">Switch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;P4 virtual switch&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                 <span class="n">device_id</span><span class="p">,</span>
                 <span class="n">sw_bin</span><span class="o">=</span><span class="s1">&#39;simple_switch&#39;</span><span class="p">,</span>  
                 <span class="n">json_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">thrift_port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pcap_dump</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">pcap_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">log_enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">log_dir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span>
                 <span class="n">enable_debugger</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device_id</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;device_id is not an integer.&#39;</span><span class="p">)</span>

        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dpid</span><span class="o">=</span><span class="n">dpidToStr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">))</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  

        <span class="bp">self</span><span class="o">.</span><span class="n">set_binary</span><span class="p">(</span><span class="n">sw_bin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_json</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">pcap_dir</span> <span class="o">=</span> <span class="n">pcap_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcap_dump</span> <span class="o">=</span> <span class="n">pcap_dump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_debugger</span> <span class="o">=</span> <span class="n">enable_debugger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_enabled</span> <span class="o">=</span> <span class="n">log_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span> <span class="o">=</span> <span class="n">log_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thrift_port</span> <span class="o">=</span> <span class="n">thrift_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nanomsg</span> <span class="o">=</span> <span class="s1">&#39;ipc:///tmp/bm-</span><span class="si">{}</span><span class="s1">-log.ipc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simple_switch_pid</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_enabled</span><span class="p">:</span>
            <span class="c1"># Make sure that the provided log path is not pointing to a file</span>
            <span class="c1"># and, if necessary, create an empty log dir</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; exists and is not a directory.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcap_dump</span><span class="p">:</span>
            <span class="c1"># Make sure that the provided pcap path is not pointing to a file</span>
            <span class="c1"># and, if necessary, create an empty pcap dir</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcap_dir</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcap_dir</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; exists and is not a directory.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcap_dir</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcap_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_listening</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ConnectionRefusedError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> cannot bind port </span><span class="si">{}</span><span class="s1"> because it is bound by another process.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_port</span><span class="p">))</span>

<div class="viewcode-block" id="P4Switch.set_binary"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.set_binary">[docs]</a>    <span class="k">def</span> <span class="nf">set_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sw_bin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set switch default binary&quot;&quot;&quot;</span>
        <span class="c1"># Make sure that the provided sw_bin is valid</span>
        <span class="n">pathCheck</span><span class="p">(</span><span class="n">sw_bin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sw_bin</span> <span class="o">=</span> <span class="n">sw_bin</span></div>

<div class="viewcode-block" id="P4Switch.set_json"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.set_json">[docs]</a>    <span class="k">def</span> <span class="nf">set_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the compiled P4 JSON file.&quot;&quot;&quot;</span>
        <span class="c1"># Make sure that the provided JSON file exists if it is not None</span>
        <span class="k">if</span> <span class="n">json_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">json_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;Invalid JSON file.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json_path</span> <span class="o">=</span> <span class="n">json_path</span></div>

<div class="viewcode-block" id="P4Switch.switch_started"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.switch_started">[docs]</a>    <span class="k">def</span> <span class="nf">switch_started</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the switch process has started.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/proc&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_switch_pid</span><span class="p">)))</span></div>

<div class="viewcode-block" id="P4Switch.thrift_listening"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.thrift_listening">[docs]</a>    <span class="k">def</span> <span class="nf">thrift_listening</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if a thrift process listens on the thrift port.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">check_listening_on_port</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thrift_port</span><span class="p">)</span></div>

<div class="viewcode-block" id="P4Switch.switch_status"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.switch_status">[docs]</a>    <span class="k">def</span> <span class="nf">switch_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if all the switch processes have started correctly.&quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;switch&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_started</span><span class="p">(),</span>
                  <span class="s1">&#39;thrift&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_listening</span><span class="p">()}</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;switch&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SWITCH_START_TIMEOUT</span> <span class="o">*</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;thrift&#39;</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;thrift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_listening</span><span class="p">()</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="P4Switch.add_arguments"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.add_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add arguments to the simple switch process&quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sw_bin</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">port</span><span class="p">,</span> <span class="n">intf</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intfs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">intf</span><span class="o">.</span><span class="n">IP</span><span class="p">():</span>
                <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">intf</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcap_dump</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcap_dir</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--pcap=&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcap_dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--pcap&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_port</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--thrift-port&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thrift_port</span><span class="p">)])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nanomsg</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--nanolog&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nanomsg</span><span class="p">])</span>
        <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--device-id&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">)])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_path</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--no-p4&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_debugger</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--debugger&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_enabled</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--log-console&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span></div>

<div class="viewcode-block" id="P4Switch.start"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controllers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start up a new P4 switch.&quot;&quot;&quot;</span>
        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting P4 switch </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">())</span>
        <span class="n">info</span><span class="p">(</span><span class="n">cmd</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simple_switch_pid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_enabled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="n">cmd</span> <span class="o">+</span> <span class="s1">&#39; &gt; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span> <span class="o">+</span> <span class="s1">&#39;/p4s.</span><span class="si">{}</span><span class="s1">.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; 2&gt;&amp;1 &amp; echo $! &gt;&gt; &#39;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="n">cmd</span> <span class="o">+</span> <span class="s1">&#39;&gt; /dev/null 2&gt;&amp;1 &amp; echo $! &gt;&gt; &#39;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simple_switch_pid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;P4 switch </span><span class="si">{}</span><span class="s1"> PID is </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_switch_pid</span><span class="p">))</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_status</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ChildProcessError</span><span class="p">(</span><span class="s1">&#39;P4 switch </span><span class="si">{}</span><span class="s1"> did not start correctly. Check the switch log file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;P4 switch </span><span class="si">{}</span><span class="s1"> has been started.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></div>

        <span class="c1"># only do this for l3..</span>
        <span class="c1">#self.cmd(&#39;sysctl&#39;, &#39;-w&#39;, &#39;net.ipv4.ip_forward=1&#39;)</span>

<div class="viewcode-block" id="P4Switch.stop_p4switch"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.stop_p4switch">[docs]</a>    <span class="k">def</span> <span class="nf">stop_p4switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Just stops simple switch without deleting interfaces.&quot;&quot;&quot;</span>
        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Stopping P4 switch </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;kill -9 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_switch_pid</span><span class="p">))</span></div>

<div class="viewcode-block" id="P4Switch.stop"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Terminate P4 switch.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;kill -9 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_switch_pid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteIntfs</span><span class="p">()</span></div>

<div class="viewcode-block" id="P4Switch.attach"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.attach">[docs]</a>    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect a data port.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="P4Switch.detach"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.detach">[docs]</a>    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Disconnect a data port.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="P4Switch.describe"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4Switch.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe P4Switch.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> -&gt; Thrift port: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_port</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="P4RuntimeSwitch"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4RuntimeSwitch">[docs]</a><span class="k">class</span> <span class="nc">P4RuntimeSwitch</span><span class="p">(</span><span class="n">P4Switch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;BMv2 switch with gRPC support&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                 <span class="n">sw_bin</span><span class="o">=</span><span class="s1">&#39;simple_switch_grpc&#39;</span><span class="p">,</span>
                 <span class="n">grpc_port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span> <span class="o">=</span> <span class="n">grpc_port</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grpc_listening</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ConnectionRefusedError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> cannot bind port </span><span class="si">{}</span><span class="s1"> because it is bound by another process.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">sw_bin</span><span class="o">=</span><span class="n">sw_bin</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="P4RuntimeSwitch.grpc_listening"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4RuntimeSwitch.grpc_listening">[docs]</a>    <span class="k">def</span> <span class="nf">grpc_listening</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if a grpc process listens on the grpc port.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">check_listening_on_port</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span><span class="p">)</span></div>

<div class="viewcode-block" id="P4RuntimeSwitch.switch_status"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4RuntimeSwitch.switch_status">[docs]</a>    <span class="k">def</span> <span class="nf">switch_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if all the switch processes have started correctly.&quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;switch&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_started</span><span class="p">(),</span>
                  <span class="s1">&#39;thrift&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_listening</span><span class="p">(),</span>
                  <span class="s1">&#39;grpc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">grpc_listening</span><span class="p">()}</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;switch&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SWITCH_START_TIMEOUT</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;thrift&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;grpc&#39;</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;thrift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_listening</span><span class="p">()</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;grpc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grpc_listening</span><span class="p">()</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="P4RuntimeSwitch.add_arguments"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4RuntimeSwitch.add_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add arguments to the simple switch process&quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-- --grpc-server-addr 0.0.0.0:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">args</span></div>

<div class="viewcode-block" id="P4RuntimeSwitch.describe"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.P4RuntimeSwitch.describe">[docs]</a>    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Describe P4RuntimeSwitch.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> -&gt; gRPC port: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="FRRouter"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.FRRouter">[docs]</a><span class="k">class</span> <span class="nc">FRRouter</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FRRouter built as Mininet node&quot;&quot;&quot;</span>

    <span class="n">DAEMONS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;zebra&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bgpd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ospfd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ospf6d&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ripd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ripngd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;isisd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pimd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ldpd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nhrpd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;eigrpd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;babeld&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sharpd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;staticd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pbrd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bfdd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fabricd&#39;</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                 <span class="n">bin_dir</span><span class="o">=</span><span class="s1">&#39;/usr/local/sbin&#39;</span><span class="p">,</span>
                 <span class="n">int_conf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">conf_dir</span><span class="o">=</span><span class="s1">&#39;./routers&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            name (string)       : name of the router</span>
<span class="sd">            bin_dir             : directory that contains the daemons binaries</span>
<span class="sd">            int_conf (string)   : path to the router integrated configuration file </span>
<span class="sd">            conf_dir (string)   : path to the directory which contains the folder with</span>
<span class="sd">                                  the configuration files for all the daemons (the folder</span>
<span class="sd">                                  is named after the router)</span>

<span class="sd">            Additional configuration parameters involve the daemon selections. The daemons</span>
<span class="sd">            &#39;zebra&#39;, &#39;ospfd&#39;, &#39;bgpd&#39;, &#39;staticd&#39; are enabled by default. To disable them pass</span>
<span class="sd">            to the router the keyword argument &lt;daemon&gt;=False. To enable other non-default </span>
<span class="sd">            daemons, pass &lt;daemon&gt;=True.</span>

<span class="sd">        Notice:</span>
<span class="sd">            If int_conf is set, the content conf_dir is not considered except for </span>
<span class="sd">            vtysh.conf which is always taken into account.</span>

<span class="sd">            If conf_dir is not specified, then conf_dir is assumed to be &#39;./routers&#39;, and the</span>
<span class="sd">            folder which contains the configuration files is then &#39;./routers/&lt;name&gt;&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span> <span class="o">=</span> <span class="n">bin_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_dir</span> <span class="o">=</span> <span class="n">conf_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_conf</span> <span class="o">=</span> <span class="n">int_conf</span>

        <span class="c1"># Make sure that the provided conf dir exists and is a directory,</span>
        <span class="c1"># if not, create a new one</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dir</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; exists and is not a directory.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dir</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Make sure that the provided ffr conf is pointing to a file</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_conf</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_conf</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IsADirectoryError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; exists and is a directory.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_conf</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_conf</span><span class="p">))</span>  

        <span class="c1"># Default daemons</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;zebra&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bgpd&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ospfd&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;staticd&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Parse daemons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daemons</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">FRRouter</span><span class="o">.</span><span class="n">DAEMONS</span> <span class="ow">and</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">daemons</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span>

<div class="viewcode-block" id="FRRouter.start"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.FRRouter.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Enable IPv4 forwarding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;sysctl -w net.ipv4.ip_forward=1&#39;</span><span class="p">)</span>
        <span class="c1"># Enable MPLS forwarding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;modprobe mpls_router&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;modprobe mpls_iptunnel&#39;</span><span class="p">)</span>

        <span class="c1"># Enable MPLS Label processing on all interfaces</span>
        <span class="k">for</span> <span class="n">intf_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameToIntf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;sysctl -w net.mpls.conf.</span><span class="si">{}</span><span class="s1">.input=1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intf_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;sysctl -w net.mpls.platform_labels=100000&#39;</span><span class="p">)</span>

        <span class="c1"># Enable reverse path loose mode filtering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;sysctl -w net.ipv4.conf.all.rp_filter=2&#39;</span><span class="p">)</span>

        <span class="c1"># Check binaries</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;zebra&quot;</span><span class="p">):</span>
            <span class="n">error</span><span class="p">(</span><span class="s2">&quot;Binaries path </span><span class="si">{}</span><span class="s2"> does not contain daemons!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">))</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daemons</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Nothing to start in router </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="c1"># Integrated configuration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">daemon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">daemons</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">daemon</span> <span class="o">==</span> <span class="s1">&#39;zebra&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start_daemon</span><span class="p">(</span><span class="n">daemon</span><span class="p">,</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span>
                                      <span class="n">u</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                                      <span class="n">g</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                                      <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                      <span class="n">M</span><span class="o">=</span><span class="s1">&#39;fpm&#39;</span><span class="p">,</span>
                                      <span class="n">i</span><span class="o">=</span><span class="s1">&#39;/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.pid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">),</span>
                                      <span class="n">log</span><span class="o">=</span><span class="s1">&#39;file:/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start_daemon</span><span class="p">(</span><span class="n">daemon</span><span class="p">,</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span>
                                      <span class="n">u</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                                      <span class="n">g</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                                      <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                      <span class="n">i</span><span class="o">=</span><span class="s1">&#39;/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.pid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">),</span>
                                      <span class="n">log</span><span class="o">=</span><span class="s1">&#39;file:/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">))</span>
            <span class="c1"># Integrated configuration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;vtysh -N &quot;</span><span class="si">{}</span><span class="s1">&quot; -f &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_conf</span><span class="p">))</span>
        <span class="c1"># Per daemon configuration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">daemon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">daemons</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">daemon</span> <span class="o">==</span> <span class="s1">&#39;zebra&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start_daemon</span><span class="p">(</span><span class="n">daemon</span><span class="p">,</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span>
                                      <span class="n">f</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.conf&#39;</span><span class="p">,</span>
                                      <span class="n">u</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                                      <span class="n">g</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                                      <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                      <span class="n">M</span><span class="o">=</span><span class="s1">&#39;fpm&#39;</span><span class="p">,</span>
                                      <span class="n">i</span><span class="o">=</span><span class="s1">&#39;/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.pid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">),</span>
                                      <span class="n">log</span><span class="o">=</span><span class="s1">&#39;file:/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start_daemon</span><span class="p">(</span><span class="n">daemon</span><span class="p">,</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span>
                                      <span class="n">f</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.conf&#39;</span><span class="p">,</span>
                                      <span class="n">u</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                                      <span class="n">g</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                                      <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                      <span class="n">i</span><span class="o">=</span><span class="s1">&#39;/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.pid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">),</span>
                                      <span class="n">log</span><span class="o">=</span><span class="s1">&#39;file:/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">))</span></div>

<div class="viewcode-block" id="FRRouter.stop"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.FRRouter.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Terminate FRRouter.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">daemon</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">daemons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Kill daemons</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;kill -9 </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pid&#39;</span><span class="p">)))</span>
            <span class="c1"># Remove pid, out and log files</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm -f &quot;/tmp/</span><span class="si">{name}</span><span class="s1">-</span><span class="si">{daemon}</span><span class="s1">.pid&quot; &#39;</span>
                      <span class="s1">&#39;&quot;/tmp/</span><span class="si">{name}</span><span class="s1">-</span><span class="si">{daemon}</span><span class="s1">.out&quot; &#39;</span>
                      <span class="s1">&#39;&quot;/tmp/</span><span class="si">{name}</span><span class="s1">-</span><span class="si">{daemon}</span><span class="s1">.log&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="n">daemon</span><span class="p">))</span>
        <span class="c1"># Remove socket directory</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm -rf /var/run/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="FRRouter.start_daemon"><a class="viewcode-back" href="../../../p4utils.mininetlib.node.html#p4utils.mininetlib.node.FRRouter.start_daemon">[docs]</a>    <span class="k">def</span> <span class="nf">start_daemon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">daemon</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start FRR on a given router.&quot;&quot;&quot;</span>
        <span class="c1"># Get PID file</span>
        <span class="n">pid_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pid_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pid_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pid_file&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pid_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;PID file not specified!&#39;</span><span class="p">)</span>

        <span class="c1"># Construct command</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">,</span> <span class="n">daemon</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="s1">&#39; &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">+=</span> <span class="s1">&#39; -</span><span class="si">{}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">+=</span> <span class="s1">&#39; --</span><span class="si">{}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">cmd</span> <span class="o">+=</span> <span class="s1">&#39; --log-level debugging&#39;</span>

        <span class="n">cmd</span> <span class="o">+=</span> <span class="s1">&#39; &gt; &quot;/tmp/</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">.out&quot; 2&gt;&amp;1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="n">cmd</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Execute command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># Retrieve PID</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pid_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daemons</span><span class="p">[</span><span class="n">daemon</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pid</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Networked Systems Group (NSG@ETH).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>